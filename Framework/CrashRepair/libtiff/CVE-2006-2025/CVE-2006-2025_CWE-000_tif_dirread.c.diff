--- CVE-2006-2025_CWE-000_tif_dirread.c_OLD.c	2024-05-20 08:39:50.416773975 +0000
+++ CVE-2006-2025_CWE-000_tif_dirread.c_NEW.c	2024-05-20 08:47:11.610673450 +0000
@@ -965,6 +965,10 @@
 {
 	int w = TIFFDataWidth((TIFFDataType) dir->tdir_type);
 	tsize_t cc = dir->tdir_count * w;
+        
+        /* Check for overflow. */
+        if (!dir->tdir_count || !w || cc / w != (tsize_t)dir->tdir_count)
+                goto bad;
 
 	if (!isMapped(tif)) {
 		if (!SeekOK(tif, dir->tdir_offset))
@@ -972,8 +976,11 @@
 		if (!ReadOK(tif, cp, cc))
 			goto bad;
 	} else {
-		if (dir->tdir_offset + cc > tif->tif_size)
-			goto bad;
+                /* Check for overflow. */
+                if ((tsize_t)dir->tdir_offset + cc < (tsize_t)dir->tdir_offset
+                    || (tsize_t)dir->tdir_offset + cc < cc
+                    || (tsize_t)dir->tdir_offset + cc > (tsize_t)tif->tif_size)
+		        goto bad;
 		_TIFFmemcpy(cp, tif->tif_base + dir->tdir_offset, cc);
 	}
 	if (tif->tif_flags & TIFF_SWAB) {
