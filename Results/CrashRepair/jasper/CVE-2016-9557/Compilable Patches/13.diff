--- PATCH 13 ---
@@ -159,8 +159,8 @@
 	rawsize = 0;
 	for (cmptno = 0, cmptparm = cmptparms; cmptno < numcmpts; ++cmptno,
 	  ++cmptparm) {
-		rawsize += cmptparm->width * cmptparm->height *
-		  (cmptparm->prec + 7) / 8;
+		if (((cmptparm->width * cmptparm->height) <= (9223372036854775807 / ((7 + (cmptparm->width * (cmptparm->height * cmptparm->prec))) + 7)))) { rawsize += cmptparm->width * cmptparm->height *
+		  (cmptparm->prec + 7) / 8; }
 	}
 	/* Decide whether to buffer the image data in memory, based on the
 	  raw size of the image. */