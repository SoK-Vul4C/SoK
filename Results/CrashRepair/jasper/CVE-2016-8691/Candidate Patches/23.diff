--- PATCH 23 ---
@@ -1532,7 +1532,7 @@
 	if ((c = jas_stream_getc(in)) == EOF) {
 		return -1;
 	}
-	if (val) {
+	if (((c != 0)) && (val)) {
 		*val = c;
 	}
 	return 0;