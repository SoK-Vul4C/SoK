import re

# 定义日志文件路径
log_file_path = 'orchestrator.log'

# 读取日志内容
with open(log_file_path, 'r') as file:
    log_data = file.read()

# 定义正则表达式来匹配补丁上下文
patch_pattern = r"evaluating candidate patch #(\d+):\n(.*?)(?=\n2025-\d+-\d+|\Z)"

# 查找所有补丁的匹配
patch_matches = re.findall(patch_pattern, log_data, flags=re.DOTALL)

# 遍历所有补丁并保存为diff文件（只保存序号小于50的补丁）
for patch_num, patch_content in patch_matches:
    patch_num = int(patch_num)  # 将补丁序号转换为整数
    
    if patch_num < 50:
        patch_filename = f"{patch_num}.diff"
        
        with open(patch_filename, 'w') as patch_file:
            patch_file.write(f"--- PATCH {patch_num} ---\n")
            patch_file.write(patch_content.strip())
            print(f"Patch {patch_num} saved as {patch_filename}")
    else:
        print(f"Patch {patch_num} skipped (sequence number >= 50)")
