--- /data/vulnloc/libtiff/CVE-2017-7599/src/libtiff/tif_dirwrite.c 2025-01-10T05:41:35.933692
+++ /data/vulnloc/libtiff/CVE-2017-7599/src/libtiff/tif_dirwrite.c 2025-01-10T05:41:35.933692
@@ -953,7 +953,7 @@
 		return (0);
 	}
 
-	switch (tif->tif_dir.td_sampleformat)
+	if (((value < 32767) && (-32768 < value))) { switch (tif->tif_dir.td_sampleformat)
 	{
 		case SAMPLEFORMAT_IEEEFP:
 			if (tif->tif_dir.td_bitspersample<=32)
@@ -1009,7 +1009,7 @@
 			break;
 		default:
 			ok = 0;
-	}
+	} }
 
 	_TIFFfree(conv);
 	return (ok);
