--- /data/vulnloc/libtiff/CVE-2017-7599/src/libtiff/tif_dirwrite.c 2025-01-10T05:37:50.330423
+++ /data/vulnloc/libtiff/CVE-2017-7599/src/libtiff/tif_dirwrite.c 2025-01-10T05:37:50.330423
@@ -976,7 +976,7 @@
 			}
 			else if (tif->tif_dir.td_bitspersample<=16)
 			{
-				for (i = 0; i < count; ++i)
+				for (i = 0; (i < count) && (((value < 32767) && (-32768 < value))); ++i)
 					((int16*)conv)[i] = (int16)value[i];
 				ok = TIFFWriteDirectoryTagSshortArray(tif,ndir,dir,tag,count,(int16*)conv);
 			}
