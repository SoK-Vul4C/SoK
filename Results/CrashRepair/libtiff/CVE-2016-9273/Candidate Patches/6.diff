--- PATCH 6 ---
@@ -243,7 +243,7 @@
 			return (0);
 		}
 		for (s = 0; s < ns; s++) {
-			if (bytecounts[s] > (uint64)bufsize) {
+			if ((((8 * s) < crepair_size(bytecounts))) && (bytecounts[s] > (uint64)bufsize)) {
 				buf = (unsigned char *)_TIFFrealloc(buf, (tmsize_t)bytecounts[s]);
 				if (!buf)
 					return (0);