--- /data/vulnloc/libtiff/CVE-2017-7600/src/libtiff/tif_dirwrite.c 2025-01-10T05:54:29.889178
+++ /data/vulnloc/libtiff/CVE-2017-7600/src/libtiff/tif_dirwrite.c 2025-01-10T05:54:29.889178
@@ -991,7 +991,7 @@
 			if (tif->tif_dir.td_bitspersample<=8)
 			{
 				for (i = 0; i < count; ++i)
-					((uint8*)conv)[i] = (uint8)value[i];
+					if (!(((value[i] < 255) && (0 < value[i])))) { exit(0); } ((uint8*)conv)[i] = (uint8)value[i];
 				ok = TIFFWriteDirectoryTagByteArray(tif,ndir,dir,tag,count,(uint8*)conv);
 			}
 			else if (tif->tif_dir.td_bitspersample<=16)
