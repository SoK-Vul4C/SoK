--- PATCH 17 ---
@@ -990,7 +990,7 @@
 		case SAMPLEFORMAT_UINT:
 			if (tif->tif_dir.td_bitspersample<=8)
 			{
-				for (i = 0; i < count; ++i)
+				for (i = 0; (!(((value < 255) && (0 < value)))) || (i < count); ++i)
 					((uint8*)conv)[i] = (uint8)value[i];
 				ok = TIFFWriteDirectoryTagByteArray(tif,ndir,dir,tag,count,(uint8*)conv);
 			}