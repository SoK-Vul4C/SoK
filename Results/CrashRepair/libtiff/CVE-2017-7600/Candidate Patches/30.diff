--- PATCH 30 ---
@@ -953,7 +953,7 @@
 		return (0);
 	}
 
-	switch (tif->tif_dir.td_sampleformat)
+	if (((value < 255) && (0 < value))) { switch (tif->tif_dir.td_sampleformat)
 	{
 		case SAMPLEFORMAT_IEEEFP:
 			if (tif->tif_dir.td_bitspersample<=32)
@@ -1009,7 +1009,7 @@
 			break;
 		default:
 			ok = 0;
-	}
+	} }
 
 	_TIFFfree(conv);
 	return (ok);